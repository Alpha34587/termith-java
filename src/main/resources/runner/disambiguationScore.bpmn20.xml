<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:flowable="http://flowable.org/bpmn"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             typeLanguage="http://www.w3.org/2001/XMLSchema"
             expressionLanguage="http://www.w3.org/1999/XPath"
             targetNamespace="http://www.flowable.org/processdef">

    <process id="termithTreeTagger" name="termithTreeTagger" isExecutable="true">

        <dataObject id="fileCleaner" name="fileCleaner" itemSubjectRef="xsd:boolean">
            <extensionElements>
                <flowable:value>false</flowable:value>
            </extensionElements>
        </dataObject>

        <dataObject id="freqMin" name="freqMin" itemSubjectRef="xsd:int">
            <extensionElements>
                <flowable:value>3</flowable:value>
            </extensionElements>
        </dataObject>

        <dataObject id="freqMax" name="freqMax" itemSubjectRef="xsd:int">
            <extensionElements>
                <flowable:value>15</flowable:value>
            </extensionElements>
        </dataObject>

        <startEvent id="startEvent"/>

        <sequenceFlow sourceRef="startEvent" targetRef="fork" />
        <parallelGateway id="fork" />

        <sequenceFlow sourceRef="fork" targetRef="xslLearn"/>
        <sequenceFlow sourceRef="fork" targetRef="xslEvaluation"/>


        <serviceTask id="xslLearn" name="transform tei learn corpus to working format "
                     flowable:class="org.atilf.delegate.disambiguation.contextLexicon.LearnXslTransformerDelegate"/>
        <serviceTask id="xslEvaluation" name="transform tei evluation corpus to working format "
                     flowable:class="org.atilf.delegate.disambiguation.evaluation.EvaluationXslTransformerDelegate"/>

        <sequenceFlow sourceRef="xslLearn" targetRef="learnExtractor"/>

        <serviceTask id="learnExtractor" name="transform tei learn corpus to working format "
                     flowable:class="org.atilf.delegate.disambiguation.contextLexicon.ContextExtractorDelegate"/>

        <parallelGateway id="forkLearn"/>
        <sequenceFlow sourceRef="learnExtractor" targetRef="forkLearn"/>
        <sequenceFlow sourceRef="forkLearn" targetRef="posCleaner"/>
        <sequenceFlow sourceRef="forkLearn" targetRef="thresholdCleaner"/>


        <serviceTask id="posCleaner" name="clean common pos"
                     flowable:class="org.atilf.delegate.disambiguation.contextLexicon.CommonWordsPosLemmaCleanerDelegate"/>

        <serviceTask id="thresholdCleaner" name="remove non relevant occurences frequences"
                     flowable:class="org.atilf.delegate.disambiguation.contextLexicon.ThresholdLexiconCleanerDelegate"/>

        <sequenceFlow sourceRef="posCleaner" targetRef="joinEvaluation"/>
        <sequenceFlow sourceRef="thresholdCleaner" targetRef="joinEvaluation"/>
        <sequenceFlow sourceRef="xslEvaluation" targetRef="joinEvaluation"/>

        <parallelGateway id="joinEvaluation"/>
        <sequenceFlow sourceRef="joinEvaluation" targetRef="evaluationExtractor"/>
        <serviceTask id="evaluationExtractor" name="extract context from evaluation corpus"
                     flowable:class="org.atilf.delegate.disambiguation.evaluation.EvaluationExtractorDelegate"/>

        <sequenceFlow sourceRef="evaluationExtractor" targetRef="evaluation"/>
        <serviceTask id="evaluation" name="comparison between lexicon profile"
                     flowable:class="org.atilf.delegate.disambiguation.evaluation.EvaluationDelegate"/>

        <sequenceFlow sourceRef="evaluation" targetRef="exporter"/>
        <serviceTask id="exporter" name="export result in tei"
                     flowable:class="org.atilf.delegate.disambiguation.disambiguationExporter.DisambiguationExporterDelegate"/>

        <!--compute score-->

        <sequenceFlow sourceRef="exporter" targetRef="xslScore"/>
        <serviceTask id="xslScore" name="transform xsl score"
                     flowable:class="org.atilf.delegate.disambiguation.evaluationScore.TransformXslScoreDelegate"/>

        <sequenceFlow sourceRef="xslScore" targetRef="aggregate"/>
        <serviceTask id="aggregate" name="aggregate terms result"
                     flowable:class="org.atilf.delegate.disambiguation.evaluationScore.AggregateTeiTermsDelegate"/>

        <sequenceFlow sourceRef="aggregate" targetRef="computeTerm"/>
        <serviceTask id="computeTerm" name="compute terms score"
                     flowable:class="org.atilf.delegate.disambiguation.evaluationScore.ComputeTermsScoreDelegate"/>

        <sequenceFlow sourceRef="xslScore" targetRef="xslTotalScore"/>
        <serviceTask id="xslTotalScore" name="compute total term Score"
                     flowable:class="org.atilf.delegate.disambiguation.evaluationScore.ComputeTotalTermsScoreDelegate"/>

        <sequenceFlow sourceRef="xslTotalScore" targetRef="exportToJson"/>
        <serviceTask id="exportToJson" name="export result to Json"
                     flowable:class="org.atilf.delegate.disambiguation.evaluationScore.ExportToJsonDelegate"/>

        <sequenceFlow sourceRef="exportToJson" targetRef="exportToCsv"/>
        <serviceTask id="exportToCsv" name="export result to Csv"
                     flowable:class="org.atilf.delegate.disambiguation.evaluationScore.ExportToCsvDelegate"/>

        <sequenceFlow sourceRef="exportToCsv" targetRef="endEvent"/>
        <endEvent id="endEvent"/>
    </process>

</definitions>
